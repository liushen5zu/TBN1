
    ;(function(){
        window.subject_id = window.subject_id || 26336252;
        "use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var c=t[n];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(e,c.key,c)}}return function(t,n,c){return n&&e(t.prototype,n),c&&e(t,c),t}}(),GalleryTopicsSelection=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={topics:[]},e}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;$.ajax({url:"https://m.douban.com/rexxar/api/v2/gallery/subject_feed?start=0&subject_id="+window.subject_id+"&ck="+get_cookie("ck"),xhrFields:{withCredentials:!0},success:function(t){e.setState({topics:t.items}),t.total&&(window.has_gallery_topics=!0)}})}},{key:"render",value:function(){var e=this.state.topics;return React.createElement("section",null,React.createElement("a",{href:"new_review?from=gallery-topics-selection&click=close",rel:"nofollow",className:"close_selection"},"跳过"),React.createElement("h1",null,"下面是否有你想写的话题？"),e.length?React.createElement("ul",{className:"gl_topics"},e.map(function(e){return React.createElement("li",{className:"topic"},React.createElement("a",{href:"new_review?from=gallery-topics-selection&click=create&topic_id="+e.topic.id,className:"comment_btn write_review",rel:"nofollow"},React.createElement("img",{src:window.write_icon}),React.createElement("span",null,window.join_label_text)),React.createElement("h2",{className:"topic_name"},e.topic.name),React.createElement("div",{className:"topic_meta"},e.topic.card_subtitle))})):React.createElement("div",null,"加载中"),React.createElement("a",{href:"new_review?from=gallery-topics-selection&click=skip",rel:"nofollow",className:"topics_skip"},React.createElement("span",null,"上面没有我想写的话题，去写影评 ＞ ")))}}]),t}(React.Component);$(function(){window.renderGalleryTopicsSelection=function(){var e=document.getElementById("gallery-topics-selection");ReactDOM.render(React.createElement(GalleryTopicsSelection,null),e)}});;
    })();
;
                var cur_sort = '';
                $('.review_filter a').on('click', function () {
                    var sort = $(this).data('sort');
                    if(sort === cur_sort) return;

                    if(sort === 'follow' && true){
                        window.location.href = '//www.douban.com/accounts/login?source=movie';
                        return;
                    }

                    if($('.review_filter').data('doing')) return;
                    $('.review_filter').data('doing', true);

                    cur_sort = sort;

                    $('.review_filter a').removeClass('cur');
                    $(this).addClass('cur');

                    $.getJSON('reviews', { sort: sort }, function(res){
                        $('.review-list').remove();
                        $('[href="reviews?sort=follow"]').parent().remove();
                        $('.reviews .review_filter').after(res.html);
                        $('.review_filter').data('doing', false);
                        $('.review_filter').removeData('doing');

                        if(res.count === 0){
                            $('.review-list').html('<span class="no-review">你关注的人还没写过长评</span>');
                        }
                    });
                });
            ;
        Do(function() {
            if (window.__init_review_list) return;
            __init_review_list = true;
                window.is_released = true
                window.txt_released = '该电影还未上映，不能投票噢'
            var _URL_LIBS = 'https://img3.doubanio.com/f/zerkalo/ae843e402115c5d933e23bd04c55523a1951bae6/js/review/editor/libs.js';
            var _URL_SETTING_JS = 'https://img3.doubanio.com/f/zerkalo/97f440e1da665c7aa2fc1aafdb29da5822fed144/js/review/editor/ng/setting_standalone.js';
            var _URL_SETTING_CSS = 'https://img3.doubanio.com/f/zerkalo/43e29c1661d06f69562f25ed0d887bb5a889d225/css/review/editor/ng/setting_standalone.css';
            var _REPORT_DIALOG_JS = 'https://img3.doubanio.com/f/shire/a14501790b4a2db257dc5be5e37d820e600703c6/js/report_dialog.js';
            var _REPORT_DIALOG_CSS = 'https://img3.doubanio.com/f/shire/b45aa277f8b8df40596b96582dafb1ed0a899a64/css/report_dialog.css';
            !function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=71)}({17:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(35),r=o(i);e.default=r.default},31:function(t,e,n){"use strict";t.exports=function(t){"complete"===document.readyState||"interactive"===document.readyState?t.call():document.attachEvent?document.attachEvent("onreadystatechange",function(){"interactive"===document.readyState&&t.call()}):document.addEventListener&&document.addEventListener("DOMContentLoaded",t)}},33:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,n){return t.addEventListener?(t.addEventListener(e,n,!1),{remove:function(){t.removeEventListener(e,n,!1)}}):t.attachEvent?(t.attachEvent("on"+e,n),{remove:function(){t.detachEvent("on"+e,n)}}):void 0}},34:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("undefined"!=typeof t&&null!=t){if(!(this instanceof i))return new i(t);var e=t.getAttribute("data-inited");e||(this.options={el:t,container:t.parentNode,prefetch:Boolean(t.getAttribute("prefetch")),previewUrl:t.getAttribute("src"),originUrl:t.getAttribute("data-original-url")},this._fetchUrl=this.options.originUrl,this.init())}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(33),a=o(r);i.prototype.prefetch=function(t){if(t&&this.options.prefetch){var e=document.createElement("link");e.rel="prefetch",e.href=t;var n=document.getElementsByTagName("link")[0];n.parentNode.insertBefore(e,n)}},i.prototype.play=function(){var t=this.options.el;t.src=this._fetchUrl,this._buttonPlay.style.display="none",this._buttonReload.style.display="none",this._loading.style.display="block"},i.prototype.reload=function(){this._buttonPlay.style.display="none",this._buttonReload.style.display="none",this._loading.style.display="block";var t=this.options.originUrl,e="_r="+Math.random();this._fetchUrl=t.indexOf("?")+1?t+"&"+e:t+"?"+e,this.play()},i.prototype.loaded=function(t){var e=this.options,t=e.el,n=e.container;t.src===this._fetchUrl&&(this._buttonPlay_click.remove(),this._buttonReload_click.remove(),this._img_load_error.remove(),this._img_load.remove(),n.removeChild(this._panel))},i.prototype.notFound=function(){var t=this.options,e=t.el,n=t.previewUrl;e.src=n,this._buttonPlay.style.display="none",this._buttonReload.style.display="block",this._loading.style.display="none"},i.prototype.init=function(){var t=this,e=this.options,n=e.el,o=e.container,i=(e.originUrl,this._panel=document.createElement("div")),r="image-gif-button-play",l="image-gif-loading",s="image-gif-button-reload";i.className="image-gif-panel",i.innerHTML='\n    <div class="image-gif-panel-inner">\n      <a href="javascript:;" class="'+r+'">GIF</a>\n      <a href="javascript:;" class="'+s+'" style="display: none">重新加载</a>\n      <span class="'+l+'" style="display: none;">加载中</span>\n    </div>\n  ',o.appendChild(i),this._buttonPlay=i.getElementsByClassName(r)[0],this._buttonReload=i.getElementsByClassName(s)[0],this._loading=i.getElementsByClassName(l)[0],this.prefetch(this._fetchUrl);var u=function(e){return function(n){n.preventDefault?n.preventDefault():n.returnValue=!1,e.call(t,n.target||n.srcElement,n.loaded?n.loaded/n.total:-1)}};this._buttonPlay_click=(0,a.default)(this._buttonPlay,"click",u(this.play)),this._buttonReload_click=(0,a.default)(this._buttonReload,"click",u(this.reload)),this._img_load=(0,a.default)(n,"load",u(this.loaded)),this._img_load_error=(0,a.default)(n,"error",u(this.notFound)),n.setAttribute("data-inited",!0)},e.default=i},35:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(){r=[];for(var t,e=document.querySelectorAll("img[data-render-type=gif]"),n=0;t=e[n];)r.push((0,c.default)(t)),n++;if("object"===("undefined"==typeof a?"undefined":l(a))&&"preloadNum"in a)for(var o=a.preloadNum;o--;)r[o]&&r[o].play()}Object.defineProperty(e,"__esModule",{value:!0});var r,a,l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=n(31),u=o(s),d=n(34),c=o(d);e.default=function(t){a=t,(0,u.default)(i)}},67:function(t,e){},71:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var i=n(17),r=o(i);n(67),window._IMAGE_GIF_RENDER=r.default}});
            (function(){var F=8;var B=window.dui||{},e="dui-dialog",x=[],t=null,f=($.browser.msie&&$.browser.version==="6.0")?true:false,D="ontouchstart" in window,d={},r={},E="j_close_dialog",c="dui-dialog",m="dui-dialog-close",a="dui-dialog-shd",q="dui-dialog-content",n="dui-dialog-iframe",j="dui-dialog-msk",p="确定",b="取消",w="提示",l="下载中，请稍候...",i='<div id="{ID}" class="'+c+' {CLS}" style="{CSS_ISHIDE}">                <span class="'+a+'"></span>                <div class="'+q+'">                    {BN_CLOSE}                    {TITLE}                    <div class="bd">{BODY}</div>                </div>            </div>',g='<a href="#" class="'+E+" "+m+'">X</a>',k='<div class="hd"><h3>{TITLE}</h3></div>',y='<iframe class="'+n+'"></iframe>',u='<div class="'+j+'"></div>',o={confirm:{text:p,method:function(G){G.close()}},cancel:{text:b,method:function(G){G.close()}}},C={url:"",nodeId:"",cls:"",content:"",title:w,width:0,height:0,visible:false,modal:false,iframe:false,maxWidth:960,autoupdate:false,cache:true,buttons:[],callback:null,dataType:"text",isStick:false,isHideClose:false,isHideTitle:false},h=function(J,I){var G={},H;for(H in I){if(I.hasOwnProperty(H)){G[H]=J[H]===undefined?I[H]:J[H]}}return G},A=function(L){var I=L.elements,H=0,J,K=[],G={"select-one":function(M){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.options[M.selectedIndex].value)},"select-multiple":function(P){var O=0,N,M=[];for(;N=P.options[O++];){if(N.selected){M.push(encodeURIComponent(P.name)+"="+encodeURIComponent(N.value))}}return M.join("&")},radio:function(M){if(M.checked){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.value)}},checkbox:function(M){if(M.checked){return encodeURIComponent(M.name)+"="+encodeURIComponent(M.value)}}};for(;J=I[H++];){if(G[J.type]){K.push(G[J.type](J))}else{K.push(encodeURIComponent(J.name)+"="+encodeURIComponent(J.value))}}return K.join("&").replace(/\&{2,}/g,"&")},v=function(G){var H=G||{};this.config=h(H,C);this.init()};v.prototype={init:function(){if(!this.config){return}this.render();this.bind();return this},render:function(J){var G=this.config,L=G.nodeId||e+x.length;x.push(L);var I=$("body"),K=I.find("."+j),H=typeof G.content==="object"?$(G.content).html():G.content;I.append(i.replace("{ID}",L).replace("{CSS_ISHIDE}",G.visible?"":"visibility:hidden;top:-999em;left:-999em;").replace("{CLS}",G.cls).replace("{TITLE}",k.replace("{TITLE}",G.title)).replace("{BN_CLOSE}",g).replace("{BODY}",H||J||""));if(G.modal&&!K.length){I.append(u);this.msk=$("."+j)}else{this.msk=K.eq(0)}this.nodeId=L;this.node=$("#"+L);this.title=$(".hd",this.node);this.body=$(".bd",this.node);this.btnClose=$("."+m,this.node);this.shadow=$("."+a,this.node);this.iframe=$("."+n,this.node);this.set(G);return this},bind:function(){var G=this;if(!f){$(window).bind({resize:s(function(){G.updatePosition()},"pos"),scroll:s(function(){G.updatePosition()},"pos")})}G.node.delegate("."+E,"click",function(H){G.close();H.preventDefault()});G.node.find("."+m).bind("click",function(H){G.close();H.preventDefault()});$("body").keypress(function(H){if(H.keyCode===27){G.close()}});return this},updateSize:function(){var I=this.node.width(),J,G=$(window).width(),K=$(window).height(),H=this.config;$(".bd",this.node).css({height:"auto","overflow-x":"visible","overflow-y":"visible"});J=this.node.height();var L=2*F;H.maxWidth=Math.min(H.maxWidth,G-L);if(I>H.maxWidth){I=H.maxWidth;this.node.css("width",I+"px")}if(J>K){$(".bd",this.node).css({height:(K-150)+"px","overflow-x":"hidden","overflow-y":"auto"})}J=this.node.height();this.shadow.width(I);this.shadow.height(J);this.iframe.width(I+L).height(J+L);return this},updatePosition:function(){if(this.config.isStick){return}var G=this.node.width(),I=this.node.height(),J=$(window),H=f?J.scrollTop():0;this.node.css({left:Math.floor(J.width()/2-G/2)+"px",top:Math.floor(J.height()/2-I/2-F)+H+"px"});return this},set:function(L){var N,Q,H,I,G=this.nodeId,O=this.nodeId||O,J=[],K=this,P=function(R){J.push(0);return G+"-"+R+"-"+J.length};if(!L){return this}if(L.width){this.node.css("width",L.width+"px");this.config.width=L.width}if(L.height){this.node.css("height",L.height+"px");this.config.height=L.height}if($.isArray(L.buttons)&&L.buttons[0]){I=$(".ft",this.node);H=[];$(L.buttons).each(function(){var S=arguments[1],R=P("bn");if(typeof S==="string"){S=o[S]}if(!S.text){return}if(S.href){H.push('<a class="'+(S.cls||"")+'" id="'+R+'" href="'+S.href+'">'+S.text+"</a> ")}else{H.push('<span class="bn-flat '+(S.cls||"")+'"><input type="button" id="'+R+'" class="'+O+'-bn" value="'+S.text+'" /></span> ')}r[R]=S.method});if(!I[0]){I=this.body.parent().append('<div class="ft">'+H.join("")+"</div>")}else{I.html(H.join(""))}this.footer=$(".ft",this.node);$(".ft input, .ft a",this.node).click(function(T){var S=this.id&&r[this.id];if(S){var R=S.call(this,K)}if(R){T.preventDefault();if(typeof R=="string"){alert(R)}}})}else{this.footer=$(".ft",this.node);this.footer.html("")}if(typeof L.isHideClose!=="undefined"){if(L.isHideClose){this.btnClose.hide()}else{this.btnClose.show()}this.config.isHideClose=L.isHideClose}if(typeof L.isHideTitle!=="undefined"){if(L.isHideTitle){this.title.hide()}else{this.title.show()}this.config.isHideTitle=L.isHideTitle}if(L.title){this.setTitle(L.title);this.config.title=L.title}if(typeof L.iframe!=="undefined"){if(!L.iframe){this.iframe.hide()}else{if(!this.iframe[0]){this.node.prepend(y);this.iframe=$("."+n,this.node)}else{this.iframe.show()}}this.config.iframe=L.iframe}if(L.content){this.body.html(typeof L.content==="object"?$(L.content).html():L.content);this.config.content=L.content}if(L.url){if(L.cache&&d[L.url]){if(L.dataType==="text"||!L.dataType){this.setContent(d[L.url])}if(L.callback){L.callback(d[L.url],this)}}else{if(L.dataType==="json"){this.setContent(l);if(this.footer){this.footer.hide()}$.getJSON(L.url,function(R){K.footer.show();d[L.url]=R;if(L.callback){L.callback(R,K)}})}else{this.setContent(l);if(this.footer){this.footer.hide()}$.ajax({url:L.url,dataType:L.dataType,success:function(R){d[L.url]=R;if(K.footer){K.footer.show()}K.setContent(R);if(L.callback){L.callback(R,K)}}})}}}var M=L.position;if(M){this.node.css({left:M[0]+"px",top:M[1]+"px"})}if(typeof L.autoupdate==="boolean"){this.config.autoupdate=L.autoupdate}if(typeof L.isStick==="boolean"){if(L.isStick){this.node.css("position","absolute")}else{this.node.css("position","fixed")}this.config.isStick=L.isStick}return this.update()},update:function(){this.updateSize();this.updatePosition();return this},setContent:function(G){this.body.html(G);return this.update()},setTitle:function(G){$("h3",this.title).html(G);return this},submit:function(I){var G=this,H=$("form",this.node);H.submit(function(M){M.preventDefault();var J=this.getAttribute("action",2),K=this.getAttribute("method")||"get",L=A(this);$[K.toLowerCase()](J,L,function(N){if(I){I(N)}},"json")});H.submit()},open:function(){this.node.appendTo("body").css("visibility","visible").show();var H=this,G=this.config,I=H.body[0];H.contentHeight=I.offsetHeight;this.watcher=!G.autoupdate?0:setInterval(function(){if(I.offsetHeight===H.contentHeight){return}H.update();H.contentHeight=I.offsetHeight},100);if(G.modal){this.msk.show().css({height:$(document).height()})}return this},close:function(){this.node.hide();this.msk.hide();this.node.trigger("dialog:close",this);clearInterval(this.watcher);return this}};B.Dialog=function(G,H){if(!H&&t){return G?t.set(G):t}if(!t&&!H){t=new v(G);return t}return new v(G)};window.dui=B;var z={};function s(G,H){return function(){var K=z[H];var J=arguments;var I=this;if(K){clearTimeout(K)}z[H]=setTimeout(function(){G.apply(I,arguments)},300)}}})();
            !function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(2),a=r(i);!function(){"loading"!==document.readyState?(0,a.default)(document):document.addEventListener?document.addEventListener("DOMContentLoaded",function(){return(0,a.default)(document)},!1):window.attachEvent("onreadystatechange",function(){"loading"!==document.readyState&&(0,a.default)(document)})}()},,function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var i=n(3),a=r(i);e.exports=function(){for(var e=void 0,t=document.querySelectorAll(".review-list .toggle_review")||[],n=t.length,r=(function(){return"_IMAGE_GIF_RENDER"in window&&setTimeout(function(){return window._IMAGE_GIF_RENDER()},300)}),i=function(t){var n=t.target,i=n.className,o=t.target.id,u=o.split("-")[1]||"",l=$("#toggle-"+u+".indicator"),d=i.match(/unfold/g),c=document.getElementById("review_"+u+"_short"),s=document.getElementById("review_"+u+"_full"),f=document.getElementById("review_"+u+"_full_content"),g=s.className.match(/loaded/g);e="/j/review/"+u+"/full",t.preventDefault(),d&&!g?($.ajaxSetup({cache:!0}),$.getJSON(e,function(e,t){f.innerHTML=e.body,s.classList.add("loaded"),s.classList.toggle("hidden"),c.classList.toggle("hidden"),l.toggleClass("unfold"),n.setAttribute("title","收起全文"),(0,a.default)(document),r()})):(s.classList.toggle("hidden"),c.classList.toggle("hidden"),l.toggleClass("unfold"),n.setAttribute("title","展开全文"))},o=0;o<n;o++)t&&t[o].addEventListener("click",i,!1);$(".btn-unfold").bind("click",function(e){e.preventDefault();var t=$(e.target),n=t.parent(".fold-hd");n.slideUp().next().slideDown()})}},function(e,t){"use strict";e.exports=function(){var e={useful_count:["有用","/j/review/{REVIEW_ID}/useful"],useless_count:["没用","/j/review/{REVIEW_ID}/useless"],spoiler:["剧透提醒已提交，谢谢","/j/review/{REVIEW_ID}/spoiler"]},t=/disabled/,n=/(\w+_count)/,r=/spoiler/,i=get_cookie("ck"),a=document.querySelectorAll(".main-panel-useful"),o=null,u="",l=function(e){return e&&"true"===e.getAttribute("data-is_owner")},d=function(e){return e&&"true"===e.getAttribute("data-can_vote")},c=function(a){if(i){a.stopPropagation();var o=a.target,c=o.className,g=c.match(n)||c.match(r),v="",m="",_="";if(!c.match(t)){if(g){if(l(a.currentTarget))return alert("不能给自己投票噢");if(!d(a.currentTarget)){var p=a.currentTarget.getAttribute("data-is_tv")?"该剧尚未播出，不能投票噢":"该电影还未上映，不能投票噢";return alert(p)}v=g[0],_=e[v][0],m=e[v][1],u=a.currentTarget.getAttribute("data-rid"),m=m.replace("{REVIEW_ID}",u)}else if(!g||!u)return;var E=$.post(m,{ck:i},function(e){if(0==e.r){if("spoiler"===v)return s();f(e,v)}});E.fail(function(){alert("网络错误")}).always(function(){})}}},s=function(t){var n=document.getElementById(u),r=n.querySelector(".spoiler");r.innerText=e.spoiler[0],r.className=r.className.replace("not-reported","disabled")},f=function(n,r){var i=document.getElementById(u);for(var a in e)if(void 0!==n[a]){var o=e[a][0]+" "+n[a],l=i.querySelector("."+a),d=l.className;(a===r||a!==r&&d.match(t))&&l.classList.toggle("disabled"),l.innerHTML=o}},g=a.length;if(1===g)o=a[0],u=o.getAttribute("data-rid"),o&&o.addEventListener("click",c,!1);else for(var v=0;v<g;v++)o=a[v],o&&o.addEventListener("click",c,!1)}}]);
            "use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),visible=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;_classCallCheck(this,e),this.container=t,this.containerHeight=t.innerHeight,this.eleList=[],this.lastVisibleEle=null,this.cbs=[],this.__start()}return _createClass(e,[{key:"__start",value:function(){var e=this;this.container.addEventListener("scroll",function(){e.__detect()}),this.container.addEventListener("resize",function(){e.containerHeight=e.container.innerHeight,e.__detect()})}},{key:"__detect",value:function(){var e=this;if(!this.eleList.length&&this.lastVisibleEle){if(null===this.lastVisibleEle)return;return this.cbs.forEach(function(t){return t(e.lastVisibleEle,null)}),void(this.lastVisibleEle=null)}var t=this.eleList.filter(function(t){var i=t.getBoundingClientRect();return i.height>e.containerHeight&&i.top<e.containerHeight&&e.containerHeight<i.bottom});if(0===t.length){if(null===this.lastVisibleEle)return;this.cbs.forEach(function(t){return t(e.lastVisibleEle,null)}),this.lastVisibleEle=null}else{if(this.lastVisibleEle===t[0])return;this.cbs.forEach(function(i){return i(e.lastVisibleEle,t[0])}),this.lastVisibleEle=t[0]}}},{key:"onChange",value:function(e){this.cbs.push(e)}},{key:"add",value:function(e){this.eleList.push(e),this.__detect()}},{key:"remove",value:function(e){this.eleList.splice(this.eleList.indexOf(e),1),this.__detect()}}]),e}();Do.ready(function(){"_REVIEW_COPY_OPTIONS"in window||(_REVIEW_COPY_OPTIONS={targetNode:".review-content",handleCopy:function(e,t){var i=t.data();if(i&&i.original){var n=["版权归作者所有，任何形式转载请联系作者。","作者："+i.author+"（来自豆瓣）","来源："+i.url,"\n\n"].join("\r\n");return n+e}}},function(e){if("undefined"!=typeof e){var t=function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!=document.selection.type?document.selection.createRange().htmlText.replace(/<br>/gi,"\r\n"):""},i=function(e,t){if(e)try{if(e.setData("Text",t),e.getData("Text").length>0)return}catch(i){if(e.setData("text/plain",t),e.getData("text/plain").length>0)return}var i=$("<div>").css({position:"absolute",left:"-99999px"}).appendTo("body");i.html(t),window.getSelection().selectAllChildren(i[0]),window.setTimeout(function(){i.remove()},200)};$("body").delegate(e.targetNode,"copy cut",function(n){var o=t();if(!(o.length<=42)){var a=e.handleCopy&&e.handleCopy(o,$(this))||null;if(a){n.preventDefault();var l=n.originalEvent.clipboardData||window.clipboardData;i(l,a)}}})}}(window._REVIEW_COPY_OPTIONS))}),Do.global(_URL_LIBS),Do.ready(_URL_SETTING_CSS,_URL_SETTING_JS,_REPORT_DIALOG_JS,_REPORT_DIALOG_CSS,function(){var e=function(e){var t,i,n=e+"=",o=document.cookie.split(";");for(t=0;t<o.length;t++){for(i=o[t];" "==i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(n))return i.substring(n.length,i.length).replace(/\"/g,"")}return null};$("body").delegate(".review-footer-action-setting a[data-rid]","click",function(t){t.preventDefault();var i=$(this).data(),n={review_id:i.rid,setting:{rating:i.rating,is_original:i.original,is_spoiler:i.spoiler,is_accept_reward:i.donate,is_open_reward:i.openDonate},subjectTitle:i.subjectTitle,displayRating:i.displayRating,displaySpoiler:i.displaySpoiler,onSubmit:function(t){var o={ck:e("ck")};o["review[original]"]=t.is_original?"on":"",o["review[donate]"]=t.is_accept_reward?"on":"",n.displayRating&&(o["review[rating]"]=t.rating),n.displaySpoiler&&(o["review[spoiler]"]=t.is_spoiler?"on":""),$.post(i.url,o,function(e){self.location.reload()})}};globalReviewSetting.open(n)})}),function(){!function(){var e=['<div class="popup-container hide">','<div class="popup-wrap">','<div class="popup-small">','<a class="close"></a>','<p class="popup-info">你的帐号存在安全风险<br/>写评论前请先输入验证码以证明是本人使用</p>','<div class="popup-btns">',' <a class="btn" href="javascript:;">前往验证</a>',"</div>","</div>","</div>","</div>"].join("");$("body").delegate("a.create-review, .top-tab .btn","click",function(t){t.preventDefault();var i=$(this),n=i;i.attr("href")||(n=i.find("a"));var o=$("div.popup-container"),a=n.attr("data-isverify"),l=n.attr("data-verify-url");if(a&&"false"!=a.toLowerCase())if($(".topic-block").length){var r=document.createElement("div");r.id="gallery-topics-selection",document.body.appendChild(r),window.renderGalleryTopicsSelection()}else location.href=n.attr("href");else o.size()<1&&($("body").append(e),o=$("div.popup-container")),o.find(".btn").attr("href",l),o.removeClass("hide")}).on("click","div.popup-container .close",function(){$("div.popup-container").addClass("hide")})}(),$("body").delegate(".review-footer-action-remove a","click",function(e){if(e.preventDefault(),confirm("真的就删了吗?")){var t=$(this).data(),i=$('<form action="'+t.url+'" method="POST"><input type="hidden" name="ck" value="'+get_cookie("ck")+'"/></form>').appendTo("body");i[0].submit()}})}(),function(){function e(e,t,i){var n=$("#r-useful_count-"+t),o=$("#r-useless_count-"+t);n.text(0===e.useful_count?"":e.useful_count),o.text(0===e.useless_count?"":e.useless_count),"useful"===i?(n.prev().attr("src",window.usefuled_icon),o.prev().attr("src",window.useless_icon)):(n.prev().attr("src",window.useful_icon),o.prev().attr("src",window.uselessed_icon))}function t(e,t){$("#review_"+e+"_short").addClass("hidden"),$("#review_"+e+"_full").removeClass("hidden").addClass("loaded"),t&&$("#review_"+e+"_full_content").html(t),$(".review-item#"+e+" .action .fold").removeClass("hidden")}function i(e){$("#review_"+e+"_short").removeClass("hidden"),$("#review_"+e+"_full").addClass("hidden"),$("#"+e).get(0).scrollIntoViewIfNeeded(),$("#review_"+e+"_short").find(".unfold").text("展开"),$("#"+e).find(".action-placeholder").remove(),$("#"+e).find(".action").removeClass("fixed-action"),$("#"+e).find(".action .fold").addClass("hidden")}var n=new visible,o=window.is_released,a=window.txt_released||"";n.onChange(function(e,t){if(e&&($(e).find(".action").removeClass("fixed-action"),$(e).find(".action-placeholder").remove()),t){$(t).append('<div class="action-placeholder" style="height: 46px;"></div>');var i=$(t).find(".action");i.addClass("fixed-action"),i.css({width:$(t).width()+"px",left:t.getBoundingClientRect().left+"px"})}}),$("body").delegate(".review-item .action .up","click",function(){var t=$(this).data("rid");return!o&&a?void alert(a):void $.post("/j/review/"+t+"/useful",{ck:get_cookie("ck")},function(i){e(i,t,"useful")})}),$("body").delegate(".review-item .action .down","click",function(){var t=$(this).data("rid");return!o&&a?void alert(a):void $.post("/j/review/"+t+"/useless",{ck:get_cookie("ck")},function(i){e(i,t,"useless")})}),$("body").delegate(".review-short","click",function(){var e=this,i=$(this).data("rid");return $(this).data("loaded")?(t(i),void n.add($(this).closest(".review-item").get(0))):void($(this).data("loading")||($(this).data("loading",!0),$(this).find(".unfold").text("加载中..."),$.getJSON("/j/review/"+i+"/full",{},function(o){t(i,o.body),$(e).data("loading",!1).data("loaded",!0),n.add($(e).closest(".review-item").get(0)),$(e).closest(".review-item").find(".action-btn.up img").attr("src",o.votes.is_useful?window.usefuled_icon:window.useful_icon),$(e).closest(".review-item").find(".action-btn.down img").attr("src",o.votes.is_useless?window.uselessed_icon:window.useless_icon)})))}),$("body").delegate(".action .fold","click",function(){var e=$(this).closest(".review-item").find(".review-short").data("rid");i(e)}),$("body").delegate("a.report","click",function(){var e=$(this).siblings(".review-content").data("url");generate_report_dialog({report_url:e,type:["subject"]})})}();
        });

        window.useful_icon = "https://img3.doubanio.com/f/zerkalo/536fd337139250b5fb3cf9e79cb65c6193f8b20b/pics/up.png";
        window.usefuled_icon = "https://img3.doubanio.com/f/zerkalo/635290bb14771c97270037be21ad50514d57acc3/pics/up-full.png";
        window.useless_icon = "https://img3.doubanio.com/f/zerkalo/68849027911140623cf338c9845893c4566db851/pics/down.png";
        window.uselessed_icon = "https://img3.doubanio.com/f/zerkalo/23cee7343568ca814238f5ef18bf8aadbe959df2/pics/down-full.png";
    